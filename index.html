<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì •ë¶€ ë³µì§€ì§€ì› ì„œë¹„ìŠ¤ ê²€ìƒ‰ê¸°</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #1e1e1e;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 1.5rem;
      background: linear-gradient(90deg, #2e2e2e, #3a3a3a);
      font-size: 1.3rem;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .container {
      padding: 1rem;
      max-width: 900px;
      margin: auto;
    }
    .filters {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    select, button {
      padding: 0.7rem;
      border-radius: 8px;
      border: none;
      font-size: 0.95rem;
    }
    select {
      background: #2b2b2b;
      color: #f5f5f5;
    }
    button {
      background: #5a5a5a;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #808080;
    }
    .results {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }
    .card {
      background: #2b2b2b;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .card h3 {
      margin: 0;
      color: #9cd67d;
    }
    .export {
      text-align: right;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <header>ì •ë¶€ ë³µì§€ì§€ì› ì„œë¹„ìŠ¤ ê²€ìƒ‰ê¸°</header>
  <div class="container">
    <div class="filters">
      <select id="age">
        <option value="">ì—°ë ¹ëŒ€ ì „ì²´</option>
        <option value="001">ì˜ìœ ì•„</option>
        <option value="002">ì•„ë™</option>
        <option value="003">ì²­ì†Œë…„</option>
        <option value="004">ì²­ë…„</option>
        <option value="005">ì¤‘ì¥ë…„</option>
        <option value="006">ë…¸ì¸</option>
      </select>
      <select id="target">
        <option value="">ì§€ì›ëŒ€ìƒ ì „ì²´</option>
        <option value="010">ì €ì†Œë“</option>
        <option value="020">ì¥ì• ì¸</option>
        <option value="030">ë…¸ì¸</option>
        <option value="040">ì˜ìœ ì•„</option>
        <option value="050">ì²­ë…„</option>
        <option value="060">ê¸°íƒ€</option>
      </select>
      <select id="theme">
        <option value="">ê´€ì‹¬ì£¼ì œ ì „ì²´</option>
        <option value="010">ì£¼ê±°Â·ê¸ˆìœµ</option>
        <option value="020">ê³ ìš©Â·ì°½ì—…</option>
        <option value="030">êµìœ¡</option>
        <option value="040">ë¬¸í™”Â·ìƒí™œ</option>
        <option value="050">ë³´ê±´ì˜ë£Œ</option>
        <option value="060">ì„ì‹ Â·ì¶œì‚°</option>
        <option value="070">ì–‘ìœ¡Â·êµìœ¡</option>
        <option value="080">ë…¸í›„</option>
        <option value="090">ì¥ì• </option>
        <option value="100">ê¸°íƒ€</option>
      </select>
    </div>
    <button onclick="search()">ğŸ” ì„ íƒìœ¼ë¡œ ê²€ìƒ‰</button>
    <div class="export">
      <button onclick="exportExcel()">â¬‡ï¸ Excel ë‚´ë³´ë‚´ê¸°</button>
    </div>
    <div class="results" id="results"></div>
  </div>

  <script>
    const PROXY = "https://muddy-limit-80e4.dynamicjmh.workers.dev/?url=";
    const ENDPOINT = "https://apis.data.go.kr/B554287/NationalWelfareInformationsV001/NationalWelfarelistV001";

    let lastResults = [];

    async function search() {
      const age = document.getElementById("age").value;
      const target = document.getElementById("target").value;
      const theme = document.getElementById("theme").value;

      const params = new URLSearchParams({
        callTp: "L",
        pageNo: "1",
        numOfRows: "20",
        srchKeyCode: "003",
        lifeArray: age,
        trgterIndvdlArray: target,
        intrsThemaArray: theme,
        orderBy: "popular"
      });

      const url = PROXY + encodeURIComponent(`${ENDPOINT}?${params.toString()}`);
      const res = await fetch(url);
      const text = await res.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(text, "text/xml");
      const items = [...xml.getElementsByTagName("servList"), ...xml.getElementsByTagName("item")];

      lastResults = [];
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      items.forEach(item => {
        const name = item.getElementsByTagName("servNm")[0]?.textContent || "ì œëª© ì—†ìŒ";
        const summary = item.getElementsByTagName("servDgst")[0]?.textContent || "";
        const period = item.getElementsByTagName("aplyPerd")[0]?.textContent || "ê¸°ê°„ ì •ë³´ ì—†ìŒ";
        const apply = item.getElementsByTagName("aplyMtd")[0]?.textContent || "ì‹ ì²­ ë°©ë²• ì—†ìŒ";

        lastResults.push({ name, summary, period, apply });

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${name}</h3>
          <p>${summary}</p>
          <p><b>ì‹ ì²­ê¸°ê°„:</b> ${period}</p>
          <p><b>ì‹ ì²­ë°©ë²•:</b> ${apply}</p>
        `;
        resultsDiv.appendChild(card);
      });
    }

    function exportExcel() {
      if (lastResults.length === 0) {
        alert("ë¨¼ì € ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ì„¸ìš”.");
        return;
      }
      const ws = XLSX.utils.json_to_sheet(lastResults);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "ë³µì§€ì„œë¹„ìŠ¤");
      XLSX.writeFile(wb, "ë³µì§€ì„œë¹„ìŠ¤_ëª©ë¡.xlsx");
    }
  </script>
</body>
</html>
