<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>정부 복지지원 서비스 검색기</title>
<style>
/* ===== Design System: Dark/Gray Sleek ===== */
:root{
  --bg:#0b0c0e;        /* page background */
  --surface:#111317;    /* cards, panels */
  --surface-2:#16181d;  /* inputs */
  --border:#262a33;
  --text:#f2f4f8;       /* primary text */
  --muted:#8b92a1;      /* secondary text */
  --brand:#9BA3AF;      /* desaturated gray-green accent */
  --accent:#2dd4bf;     /* action accent for focus/hover */
  --ok:#22c55e; --err:#ef4444; --warn:#f59e0b;
}
/* Light fallback (if user prefers light) */
@media (prefers-color-scheme: light){
  :root{ --bg:#f7f8f9; --surface:#ffffff; --surface-2:#f9fafb; --border:#e5e7eb; --text:#0b1220; --muted:#647085; --brand:#4B5563; --accent:#2dd4bf; }
}
html,body{height:100%}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", Pretendard, Noto Sans KR, sans-serif}
.container{max-width:980px;margin:0 auto;padding:16px}
.header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(120%) blur(6px);background:color-mix(in oklab,var(--bg) 82%, transparent);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 16px;border-radius:0 0 16px 16px}
.logo{font-weight:800;color:var(--text);letter-spacing:0.2px}
.theme-toggle{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);background:var(--surface-2);color:var(--text);padding:8px 12px;border-radius:999px;font-size:13px;cursor:pointer}
.theme-toggle:focus-visible{outline:2px solid var(--accent);outline-offset:2px}

.select, .btn{padding:12px 14px;border:1px solid var(--border);border-radius:12px;background:#2b3036;color:#f8fafc;cursor:pointer;font-size:14px;box-shadow:0 1px 0 rgba(255,255,255,.04) inset}
.select{min-width:160px}
.select:focus-visible, .btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.btn{transition:transform .06s ease}
.btn:active{transform:scale(.98)}
.btn.primary{background:#3a3f47;border-color:#3a3f47;color:#ffffff}
.btn.primary:hover{background:#2c3138}

.filters{display:flex;gap:8px;flex-wrap:nowrap;overflow-x:auto;margin:12px 0;padding-bottom:6px}
.filters::-webkit-scrollbar{height:8px}
.filters::-webkit-scrollbar-thumb{background:var(--border);border-radius:999px}
.controls{display:flex;gap:8px;margin-top:8px}
.controls input[type="search"]{flex:1;padding:12px 14px;border:1px solid var(--border);border-radius:12px;background:var(--surface-2);color:var(--text)}

.grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;margin-top:14px}
@media (max-width:1024px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
@media (max-width:640px){ .grid{grid-template-columns:1fr;} .select{min-width:220px} }

.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.card h3{margin:0 0 6px;font-size:17px;line-height:1.3}
.meta{font-size:12px;color:var(--muted);margin-bottom:8px}
.kv{font-size:13px;color:var(--text);background:var(--surface-2);border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:8px}
.kv b{display:inline-block;width:92px;color:#cdd3dd}
.actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.footer{margin:16px 0 4px;color:var(--muted);font-size:12px;text-align:center}
.empty{padding:24px;border:1px dashed var(--border);border-radius:16px;background:var(--surface);color:var(--muted);text-align:center}
.loader{display:none;margin-top:12px;color:var(--muted)}
.loader.show{display:block}
.badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border)}
.badge.y{background:color-mix(in oklab, var(--ok) 20%, var(--surface));color:#16a34a}
.badge.n{background:color-mix(in oklab, var(--err) 14%, var(--surface));color:#ef4444}
.diag{margin-top:12px;border:1px solid var(--border);border-radius:12px;background:var(--surface)}
.diag summary{cursor:pointer;padding:10px 12px;font-weight:600;color:#cbd5e1}
.diag pre{margin:0;padding:12px;white-space:pre-wrap;word-break:break-all;background:var(--surface-2);color:#d1d5db}

/* Touch-friendly tap targets on mobile */
@media (max-width:480px){
  .btn, .select { padding:14px 16px; font-size:15px; }
  .header{padding:8px 12px}
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce){
  .btn{transition:none}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">정부 복지지원 서비스 검색기</div>
<button id="themeBtn" class="theme-toggle" aria-label="테마 전환">🌗 테마</button>
  </div>

  <!-- 카테고리 우선 플로우 -->
  <div class="filters">
    <select id="lifeArray" class="select" title="연령대">
      <option value="">연령대 전체</option>
      <option value="001">영유아</option>
      <option value="002">아동</option>
      <option value="003">청소년</option>
      <option value="004">청년</option>
      <option value="005">중장년</option>
      <option value="006">노년</option>
      <option value="007">임신·출산</option>
    </select>
    <select id="trgterIndvdlArray" class="select" title="지원대상">
      <option value="">지원대상 전체</option>
      <option value="010">다문화·탈북민</option>
      <option value="020">다자녀</option>
      <option value="030">보훈대상자</option>
      <option value="040">장애인</option>
      <option value="050">저소득</option>
      <option value="060">한부모·조손</option>
    </select>
    <select id="intrsThemaArray" class="select" title="관심주제">
      <option value="">관심주제 전체</option>
      <option value="010">신체건강</option>
      <option value="020">정신건강</option>
      <option value="030">생활지원</option>
      <option value="040">주거</option>
      <option value="050">일자리</option>
      <option value="060">문화·여가</option>
      <option value="070">안전·위기</option>
      <option value="080">임신·출산</option>
      <option value="090">보육</option>
      <option value="100">교육</option>
      <option value="110">입양·위탁</option>
      <option value="120">보호·돌봄</option>
      <option value="130">서민금융</option>
      <option value="140">법률</option>
      <option value="160">에너지</option>
    </select>
    <button id="runBtn" class="btn primary" title="선택 기준으로 일괄 검색">🔍 선택으로 검색</button>
    <button id="exportBtn" class="btn" title="현재 결과를 XLSX로 저장">⬇️ 엑셀(.xlsx)로 추출</button>
  </div>

    <!-- (옵션) 고급검색: 키워드 보조 입력 -->
  <details style="margin:0 0 8px;border:1px dashed #d9ddcc;border-radius:12px;background:#fcfdf9">
    <summary style="cursor:pointer;padding:8px 12px;font-weight:600;color:#3b4a2a">고급검색 (키워드 보조)</summary>
    <div class="controls">
      <input id="q" type="search" style="flex:1;padding:12px 14px;border:1px solid #d9ddcc;border-radius:12px;background:#fff" placeholder="필요 시 키워드를 보조로 입력하세요." />
      <button id="searchBtn" class="btn">키워드 검색</button>
    </div>
  </details>

  <div id="loader" class="loader">불러오는 중...</div>
  <div id="notice" style="display:none;margin-top:10px;padding:10px;border-radius:10px;border:1px solid #f59e0b;background:#fff7ed;color:#92400e;font-size:13px"></div>
  <div id="results" class="grid"></div>
    <div class="footer">정보 제공: 보건복지부 · 한국사회보장정보원 (공공데이터포털)</div>
</div>
<script>
// ===== Theme boot =====
(function(){
  try{
    const saved = localStorage.getItem('theme');
    if(saved==='dark') document.documentElement.dataset.theme='dark';
    if(saved==='light') document.documentElement.dataset.theme='light';
  }catch(_){/* ignore */}
})();

// === 구성값 ===
// 🔐 인증키: 인코딩/디코딩 2종 모두 보관
// 🔐 serviceKey는 프록시(Cloudflare Worker)에서 주입됩니다. 클라이언트에 키를 절대 노출하지 않습니다.

// 엔드포인트 (http/https 모두 시도)
const BASE_URL_HTTPS = "https://apis.data.go.kr/B554287/NationalWelfareInformationsV001/NationalWelfarelistV001";
const BASE_URL_HTTP  = "http://apis.data.go.kr/B554287/NationalWelfareInformationsV001/NationalWelfarelistV001";
let USE_PROXY = true;    // CORS 회피 기본 on (운영시 자체 프록시 권장)
let PROXY_URL = "https://muddy-limit-80e4.dynamicjmh.workers.dev/?url="; // Cloudflare Worker 프록시

// === 유틸 ===
// Theme toggle
(function(){
  const btn = document.getElementById('themeBtn');
  if(!btn) return;
  btn.addEventListener('click', ()=>{
    const cur = document.documentElement.dataset.theme;
    const next = cur==='dark' ? 'light' : 'dark';
    document.documentElement.dataset.theme = next;
    try{ localStorage.setItem('theme', next); }catch(_){/* noop */}
  });
})();
const $ = (s)=>document.querySelector(s);
function setDiag(txt){ const box=$("#diagBox"); if(box) box.textContent = txt; }
function fmtDate8(yyyymmdd){ if(!yyyymmdd||yyyymmdd.length<8) return yyyymmdd||''; return `${yyyymmdd.slice(0,4)}-${yyyymmdd.slice(4,6)}-${yyyymmdd.slice(6,8)}`; }

// 키 모드: ENC (인코딩키 그대로), DEC_ENC1 (디코딩키 1회 인코딩), DEC_RAW (디코딩키 원문 그대로)

function buildUrl(query, baseUrl){
  const u = new URL(baseUrl);
  // serviceKey는 프록시에서 자동 주입됨
  u.searchParams.set("callTp", "L");
  u.searchParams.set("pageNo", "1");
  u.searchParams.set("numOfRows", "50");
  u.searchParams.set("srchKeyCode", "003"); // 제목+내용
  if(query) u.searchParams.set("searchWrd", query);
  const life = $("#lifeArray").value;
  const trg = $("#trgterIndvdlArray").value;
  const intrs = $("#intrsThemaArray").value;
  if(life) u.searchParams.set("lifeArray", life);
  if(trg) u.searchParams.set("trgterIndvdlArray", trg);
  if(intrs) u.searchParams.set("intrsThemaArray", intrs);
  u.searchParams.set("orderBy", "popular");
  return u.toString();
}

async function fetchData(query){
  const attempts = [
    { base: BASE_URL_HTTPS, label: 'HTTPS' },
    { base: BASE_URL_HTTP,  label: 'HTTP' }
  ];

  const tryUrlForProxy = (raw)=> USE_PROXY && PROXY_URL ? PROXY_URL + encodeURIComponent(raw) : raw;

  let lastText = '', lastStatus = 0, lastCT = '';
  for (let i=0;i<attempts.length;i++){
    const { base, mode, label } = attempts[i];
    const url = buildUrl(query, base);
    $("#loader").classList.add("show");
    setDiag(`시도 ${i+1}/${attempts.length}: ${label}
요청 URL: ${url.replace(/(serviceKey=)[^&]+/,'$1***masked***')}
프록시 사용: ${USE_PROXY ? '예' : '아니오'}`);
    try{
      const res = await fetch(tryUrlForProxy(url), { headers: { 'Accept': 'application/xml,text/xml;q=0.9,application/json;q=0.8,*/*;q=0.7' } });
      lastCT = res.headers.get('content-type')||''; lastStatus = res.status; const text = await res.text(); lastText = text;
      setDiag([
        `시도 ${i+1}/${attempts.length}: ${label}`,
        `요청 URL: ${url.replace(/(serviceKey=)[^&]+/,'$1***masked***')}`,
        `상태: ${lastStatus}`,
        `Content-Type: ${lastCT}`,
        `본문(앞 300자):`,
        text.slice(0,300)
      ].join('\n'));
      if(!res.ok) throw new Error(`HTTP ${res.status}`);

      if(text.trim().startsWith('<')){
        const doc = new DOMParser().parseFromString(text, 'text/xml');
        const errHeader = doc.getElementsByTagName('cmnMsgHeader')[0] || doc.getElementsByTagName('cmmMsgHeader')[0];
        if(errHeader){
          const reason = errHeader.getElementsByTagName('returnReasonCode')[0]?.textContent||'';
          const authMsg = errHeader.getElementsByTagName('returnAuthMsg')[0]?.textContent||'';
          const errMsg = errHeader.getElementsByTagName('errMsg')[0]?.textContent||'';
          if(String(reason).trim()==='30' || /SERVICE_KEY_IS_NOT_REGISTERED_ERROR/.test(authMsg)){
            // 다음 시도로 넘어감
            continue;
          }
          if(errMsg || authMsg || reason){
            // 다른 오류면 바로 표시하고 중단
            setDiag((document.getElementById('diagBox').textContent||'')+`
[API 응답오류] ${errMsg} / ${authMsg} / CODE=${reason}`);
            return [];
          }
        }
        // 정상 응답 파싱
        const getTxt = (node, names)=>{ for(const nm of names){ const el=node.getElementsByTagName(nm)[0]; if(el && (el.textContent||'').trim()!=='') return el.textContent; } return ''; };
        let containers = Array.from(doc.getElementsByTagName('servList'));
        if(containers.length===0) containers = Array.from(doc.getElementsByTagName('item'));
        if(containers.length===0){ const servs = Array.from(doc.getElementsByTagName('servNm')); containers = servs.map(s=>s.parentElement).filter(Boolean); }
        const items = containers.map(n=>({
          servNm: getTxt(n,['servNm','svcNm','serviceNm']),
          jurMnofNm: getTxt(n,['jurMnofNm','mngtMofNm','deptNm']),
          servDgst: getTxt(n,['servDgst','summary','servDtlCn']),
          servDtlLink: getTxt(n,['servDtlLink','servDtlLinkAddr','detailLink']),
          lifeArray: getTxt(n,['lifeArray']),
          trgterIndvdlArray: getTxt(n,['trgterIndvdlArray']),
          intrsThemaArray: getTxt(n,['intrsThemaArray']),
          onapPsbltYn: getTxt(n,['onapPsbltYn','onlineApplyYn']),
          sprtCycNm: getTxt(n,['sprtCycNm','supportCycle']),
          svcfrstRegTs: getTxt(n,['svcfrstRegTs','regDate'])
        })).filter(it=> (it.servNm||'').trim()!=='');
        return items;
      }

      try{ const json = JSON.parse(text); return (json?.response?.body?.items?.item)||[]; } catch { /* fallthrough */ }
    }catch(err){
      // 다음 시도 진행
      continue;
    }finally{ $("#loader").classList.remove("show"); }
  }
  // 모든 시도 실패 → 마지막 응답을 남김
  setDiag((document.getElementById('diagBox').textContent||'')+`
모든 시도 실패 (인증키/엔드포인트 조합). 마지막 상태=${lastStatus}, CT=${lastCT}`);
  return [];
}

function renderResults(items){
  const results = document.querySelector('#results');
  results.innerHTML = '';
  const notice = document.getElementById('notice');
  const diag = document.getElementById('diagBox').textContent||'';
  if(/Failed to fetch|CORS|blocked|NetworkError/i.test(diag)){
    notice.style.display='block';
    notice.innerHTML = `브라우저 CORS로 차단되어 데이터 수신이 실패했습니다. 현재 프록시(${PROXY_URL})를 사용 중입니다.`;
  } else { notice.style.display='none'; }

  if(!items || items.length===0){
    results.innerHTML='<div class="empty">검색 결과 없음</div>';
    return;
  }
  const pickIcon = (it)=>{
    const life = (it.lifeArray||'').trim();
    const intr = (it.intrsThemaArray||'').trim();
    if(/영유아|보육/.test(life+intr)) return '🧸';
    if(/아동|교육/.test(life+intr)) return '📚';
    if(/청소년|청년|일자리/.test(life+intr)) return '💼';
    if(/중장년|노년|돌봄/.test(life+intr)) return '👵';
    if(/주거/.test(life+intr)) return '🏠';
    if(/건강|신체건강|정신건강/.test(life+intr)) return '🩺';
    if(/서민금융|금융/.test(life+intr)) return '💳';
    if(/법률/.test(life+intr)) return '⚖️';
    if(/에너지/.test(life+intr)) return '🔌';
    return '🏛️';
  };
  window.currentItems = items;
  items.forEach(it=>{
    const card=document.createElement('div');
    card.className='card';
    card.style.transition='transform .12s ease, box-shadow .12s ease';
    card.addEventListener('mouseenter',()=>{card.style.transform='translateY(-2px)'; card.style.boxShadow='0 14px 34px rgba(0,0,0,.35)';});
    card.addEventListener('mouseleave',()=>{card.style.transform='none'; card.style.boxShadow='0 10px 30px rgba(0,0,0,.25)';});
    const ynFlag = (it.onapPsbltYn||'').trim().toUpperCase();
    const yn = ynFlag==='Y' ? '<span class="badge y">온라인 신청 가능</span>' : (ynFlag==='N'?'<span class="badge n">온라인 신청 불가</span>':'-');
    const link = it.servDtlLink||'#';
    const icon = pickIcon(it);
    card.innerHTML = `
      <h3>${icon} ${it.servNm||''}</h3>
      <div class="meta">${it.jurMnofNm||''}</div>
      <p>${it.servDgst||''}</p>
      <div class="kv">
        <div><b>연령대</b> <span>${it.lifeArray||'-'}</span></div>
        <div><b>지원대상</b> <span>${it.trgterIndvdlArray||'-'}</span></div>
        <div><b>관심주제</b> <span>${it.intrsThemaArray||'-'}</span></div>
        <div><b>신청여부</b> <span>${yn}</span></div>
        <div><b>지원주기</b> <span>${it.sprtCycNm||'-'}</span></div>
        <div><b>등록일</b> <span>${fmtDate8(it.svcfrstRegTs)||'-'}</span></div>
      </div>
      <div class="actions">
        <a class="btn primary" href="${link}" target="_blank" rel="noopener">자세히 보기</a>
        <button class="btn" onclick="copyLink('${link.replace(/'/g,"&#39;")}')">링크 복사</button>
      </div>
    `;
    results.appendChild(card);
  });
}

function copyLink(href){
  if(!href) return;
  navigator.clipboard?.writeText(href).then(()=>{ alert('링크가 복사되었습니다.'); });
}

async function doSearch(){
  const qEl=$("#q");
  const q = qEl ? qEl.value.trim() : ""; // 키워드는 보조
  const items=await fetchData(q||undefined);
  renderResults(items);
}

// 이벤트 바인딩 (파싱 에러 방지 후 정상 작동)
$("#runBtn").addEventListener("click", doSearch);
const searchBtn = $("#searchBtn"); if(searchBtn){ searchBtn.addEventListener("click", doSearch); }
const qInput = $("#q"); if(qInput){ qInput.addEventListener("keydown", e=>{ if(e.key === "Enter") doSearch(); }); }


// ===== XLSX 내보내기 =====
function crc32(str){ const table=(function(){let c,t=[];for(let n=0;n<256;n++){c=n;for(let k=0;k<8;k++){c=((c&1)?(0xEDB88320^(c>>>1)):(c>>>1));}t[n]=c>>>0;}return t;})(); let crc=-1; for(let i=0;i<str.length;i++){const code=str.charCodeAt(i); crc=(crc>>>8)^table[(crc^code)&0xFF];} return (crc^(-1))>>>0; }
function strToUint8(str){ const a=new Uint8Array(str.length); for(let i=0;i<str.length;i++) a[i]=str.charCodeAt(i)&0xFF; return a; }
function dateToDos(t){ const d=new Date(t||Date.now()); const y=d.getFullYear()>1980? d.getFullYear()-1980:0; const time=(d.getHours()<<11)|(d.getMinutes()<<5)|(Math.floor(d.getSeconds()/2)); const date=(y<<9)|((d.getMonth()+1)<<5)|d.getDate(); return {dosTime:time,dosDate:date}; }
function makeZip(files){ const enc=strToUint8; const parts=[]; const central=[]; let offset=0; const now=dateToDos(); files.forEach(f=>{ const data=enc(f.content); const crc=crc32(f.content); const name=enc(f.name); const lf=new Uint8Array(30+name.length); const v=new DataView(lf.buffer); v.setUint32(0,0x04034b50,true); v.setUint16(4,20,true); v.setUint16(6,0,true); v.setUint16(8,0,true); v.setUint16(10,now.dosTime,true); v.setUint16(12,now.dosDate,true); v.setUint32(14,crc,true); v.setUint32(18,data.length,true); v.setUint32(22,data.length,true); v.setUint16(26,name.length,true); v.setUint16(28,0,true); lf.set(name,30); parts.push(lf); offset+=lf.length; parts.push(data); offset+=data.length; const cd=new Uint8Array(46+name.length); const cv=new DataView(cd.buffer); cv.setUint32(0,0x02014b50,true); cv.setUint16(4,20,true); cv.setUint16(6,20,true); cv.setUint16(8,0,true); cv.setUint16(10,0,true); cv.setUint16(12,now.dosTime,true); cv.setUint16(14,now.dosDate,true); cv.setUint32(16,crc,true); cv.setUint32(20,data.length,true); cv.setUint32(24,data.length,true); cv.setUint16(28,name.length,true); cv.setUint16(30,0,true); cv.setUint16(32,0,true); cv.setUint16(34,0,true); cv.setUint16(36,0,true); cv.setUint32(38,0,true); cv.setUint32(42, f._offset = (offset-(lf.length+data.length)), true); cd.set(name,46); central.push(cd); }); const centralSize=central.reduce((s,a)=>s+a.length,0); const centralOffset=offset; central.forEach(c=>{ parts.push(c); offset+=c.length; }); const eocd=new Uint8Array(22); const ev=new DataView(eocd.buffer); ev.setUint32(0,0x06054b50,true); ev.setUint16(4,0,true); ev.setUint16(6,0,true); ev.setUint16(8,files.length,true); ev.setUint16(10,files.length,true); ev.setUint32(12,centralSize,true); ev.setUint32(16,centralOffset,true); ev.setUint16(20,0,true); parts.push(eocd); let total=0; parts.forEach(p=> total+=p.length); const out=new Uint8Array(total); let pos=0; parts.forEach(p=>{ out.set(p,pos); pos+=p.length; }); return new Blob([out], { type:'application/zip' }); }
function buildXlsx(items){ const esc=s=>String(s??'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); const rows=[["서비스명","소관부처","요약","연령대","지원대상","관심주제","신청가능","지원주기","등록일","상세링크"]].concat(items.map(it=>[it.servNm||'',it.jurMnofNm||'',it.servDgst||'',it.lifeArray||'',it.trgterIndvdlArray||'',it.intrsThemaArray||'',(it.onapPsbltYn||''),it.sprtCycNm||'',fmtDate8(it.svcfrstRegTs)||'',it.servDtlLink||''])); let sheet=`<?xml version="1.0" encoding="UTF-8"?>\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"><sheetData>`; rows.forEach((r,ri)=>{ sheet+=`<row r="${ri+1}">`; r.forEach((c,ci)=>{ const col=String.fromCharCode(65+(ci%26))+(ri+1); sheet+=`<c r="${col}" t="inlineStr"><is><t>${esc(c)}</t></is></c>`; }); sheet+=`</row>`; }); sheet+=`</sheetData></worksheet>`; const contentTypes=`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml" ContentType="application/xml"/>
  <Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/>
  <Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/>
  <Override PartName="/docProps/core.xml" ContentType="application/vnd.openxmlformats-package.core-properties+xml"/>
  <Override PartName="/docProps/app.xml" ContentType="application/vnd.openxmlformats-officedocument.extended-properties+xml"/>
</Types>`; const rels=`<?xml version="1.0" encoding="UTF-8"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="/xl/workbook.xml"/>
</Relationships>`; const wb=`<?xml version="1.0" encoding="UTF-8"?>
<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">
  <sheets>
    <sheet name="welfare" sheetId="1" r:id="rId1"/>
  </sheets>
</workbook>`; const wbRels=`<?xml version="1.0" encoding="UTF-8"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/>
</Relationships>`; const core=`<?xml version="1.0" encoding="UTF-8"?>
<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:dcmitype="http://purl.org/dc/dcmitype/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <dc:title>welfare_services</dc:title>
  <dc:creator>위젯</dc:creator>
  <cp:lastModifiedBy>위젯</cp:lastModifiedBy>
  <dcterms:created xsi:type="dcterms:W3CDTF">${new Date().toISOString()}</dcterms:created>
</cp:coreProperties>`; const app=`<?xml version="1.0" encoding="UTF-8"?>
<Properties xmlns="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties" xmlns:vt="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes">
  <Application>WebApp</Application>
</Properties>`; const files=[{name:"[Content_Types].xml",content:contentTypes},{name:"_rels/.rels",content:rels},{name:"xl/workbook.xml",content:wb},{name:"xl/_rels/workbook.xml.rels",content:wbRels},{name:"xl/worksheets/sheet1.xml",content:sheet},{name:"docProps/core.xml",content:core},{name:"docProps/app.xml",content:app}]; return makeZip(files); }
function exportToXlsx(){ if(!window.currentItems||window.currentItems.length===0){ alert('내보낼 데이터가 없습니다.'); return; } const blob=buildXlsx(window.currentItems); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='welfare_services.xlsx'; a.click(); URL.revokeObjectURL(url); }
$("#exportBtn").addEventListener("click", exportToXlsx);
</script>
</body>
</html>
